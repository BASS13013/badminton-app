<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#047857">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Badminton Pro">
    <title>Badminton Pro</title>
    
    <!-- IC√îNE DE L'APPLICATION -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23fbbf24'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle'%3Eüè∏%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23fbbf24'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle'%3Eüè∏%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { 
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Poppins', system-ui, sans-serif;
        }
        body { 
            margin: 0;
            background: linear-gradient(135deg, #0f766e 0%, #047857 50%, #065f46 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .match-done { background: linear-gradient(135deg, #10b981 0%, #059669 100%); opacity: 0.7; }
        .match-pending { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .badminton-icon {
            width: 120px; height: 120px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin: 0 auto 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        /* PAGE PLEIN √âCRAN POUR LES ZONES */
        .page-zones-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #047857, #065f46);
            z-index: 99999;
            display: none;
            flex-direction: column;
            padding: 20px;
        }
        .page-zones-fullscreen.active {
            display: flex !important;
        }
        
        /* PAGE PLEIN √âCRAN POUR LES ERREURS DE SERVICE */
        .page-service-erreur-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            z-index: 99999;
            display: none;
            flex-direction: column;
            padding: 20px;
        }
        .page-service-erreur-fullscreen.active {
            display: flex !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        console.log('üè∏ Badminton Pro v2.2 - Avec objet Service');

        const Icon = ({d, className = "w-6 h-6"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={d} /></svg>;
        const Users = ({className}) => <Icon className={className} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />;
        const Target = ({className}) => <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;
        const Zap = ({className}) => <Icon className={className} d="M13 10V3L4 14h7v7l9-11h-7z" />;
        const MapPin = ({className}) => <Icon className={className} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />;
        const Clock = ({className}) => <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>;
        const Trophy = ({className}) => <Icon className={className} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />;
        const RotateCcw = ({className}) => <Icon className={className} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />;
        const ChevronRight = ({className}) => <Icon className={className} d="M9 5l7 7-7 7" />;
        const Trash2 = ({className}) => <Icon className={className} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />;
        const Edit = ({className}) => <Icon className={className} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />;
        const Save = ({className}) => <Icon className={className} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />;
        const BarChart = ({className}) => <Icon className={className} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />;
        const Send = ({className}) => <Icon className={className} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />;

        function BadmintonTracker() {
          const [config, setConfig] = useState({classe: '', nombreJoueurs: 0, joueurs: [], typeMatch: '', mortSubite: false, objetEnseignement: '', pointsDoubles: false});
          const [poule, setPoule] = useState([]);
          const [matchEnCours, setMatchEnCours] = useState(null);
          const [historiquePoints, setHistoriquePoints] = useState([]);
          const [timer, setTimer] = useState(180);
          const [timerActif, setTimerActif] = useState(false);
          const [phase, setPhase] = useState('classe');
          const [donnees, setDonnees] = useState({});
          const [classes, setClasses] = useState({});
          const [showDeleteModal, setShowDeleteModal] = useState(false);
          const [showTerrain, setShowTerrain] = useState(false);
          const [showServiceErreur, setShowServiceErreur] = useState(false);
          const [matchsTermines, setMatchsTermines] = useState([]);
          const [showEditMatch, setShowEditMatch] = useState(null);
          const [seances, setSeances] = useState({});
          const [currentSeance, setCurrentSeance] = useState(1);

          // CORRECTION CRITIQUE : D√©tection automatique de fin de match
          useEffect(() => {
            if (matchEnCours && config.typeMatch !== '3min') {
              console.log('‚úì V√©rif scores:', matchEnCours.scoreJ1, 'vs', matchEnCours.scoreJ2, '/ max:', matchEnCours.pointsMax);
              
              if (matchEnCours.scoreJ1 >= matchEnCours.pointsMax) {
                console.log('üèÜ J1 gagne avec', matchEnCours.scoreJ1, 'points !');
                setTimeout(() => terminerMatch(), 800);
              } else if (matchEnCours.scoreJ2 >= matchEnCours.pointsMax) {
                console.log('üèÜ J2 gagne avec', matchEnCours.scoreJ2, 'points !');
                setTimeout(() => terminerMatch(), 800);
              }
            }
          }, [matchEnCours?.scoreJ1, matchEnCours?.scoreJ2]);

          useEffect(() => {
            const saved = localStorage.getItem('badmintonData');
            if (saved) {
              try {
                const parsed = JSON.parse(saved);
                setClasses(parsed.classes || {});
                setSeances(parsed.seances || {});
              } catch (err) { console.error('Erreur chargement', err); }
            }
          }, []);

          const sauvegarderDonnees = () => {
            try {
              localStorage.setItem('badmintonData', JSON.stringify({classes, seances}));
              console.log('‚úÖ Donn√©es sauvegard√©es');
            } catch (err) { console.error('‚ùå Erreur sauvegarde', err); }
          };

          useEffect(() => {
            if (timerActif && timer > 0) {
              const interval = setInterval(() => setTimer(t => t > 0 ? t - 1 : 0), 1000);
              return () => clearInterval(interval);
            } else if (timerActif && timer === 0 && matchEnCours) {
              setTimerActif(false);
              terminerMatch();
            }
          }, [timerActif, timer]);

          const formatTimer = (secondes) => {
            const mins = Math.floor(secondes / 60);
            const secs = secondes % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          const ajouterJoueur = () => {
            const nouvelleConfig = {...config, joueurs: [...config.joueurs, {prenom: '', nom: ''}]};
            setConfig(nouvelleConfig);
          };

          const modifierJoueur = (index, champ, valeur) => {
            const nouveauxJoueurs = [...config.joueurs];
            nouveauxJoueurs[index][champ] = valeur;
            setConfig({...config, joueurs: nouveauxJoueurs});
          };

          const demarrerPoule = () => {
            const nouvelleDonnees = {};
            config.joueurs.forEach(j => {
              nouvelleDonnees[`${j.prenom}_${j.nom}`] = {
                nom: j.nom, prenom: j.prenom, 
                zonesDangereuses: 0, smashAnnonces: 0, zonesLibres: 0,
                pointsSurService: 0, servicesRates: 0,
                erreursServiceNonTouche: 0, erreursServiceRiviere: 0,
                erreursServiceNonCroise: 0, erreursServiceFilet: 0,
                pointsDoubles: 0, matchsJoues: 0, matchsGagnes: 0, 
                pointsMarques: 0, pointsEncaisses: 0,
                defaitesMortSubite: 0, victoires: [], pointsTerrain: []
              };
            });
            setDonnees(nouvelleDonnees);
            setPoule(config.joueurs);
            setMatchsTermines([]);
            if (!seances[config.classe]) seances[config.classe] = {};
            if (!seances[config.classe][currentSeance]) {
              seances[config.classe][currentSeance] = { date: new Date().toISOString(), donnees: nouvelleDonnees };
            }
            setClasses(prev => ({...prev, [config.classe]: nouvelleDonnees}));
            setPhase('selection');
          };

          const getMatchKey = (j1, j2) => {
            const key1 = `${j1.prenom}_${j1.nom}`;
            const key2 = `${j2.prenom}_${j2.nom}`;
            return [key1, key2].sort().join('-vs-');
          };

          const isMatchTermine = (j1, j2) => {
            const key = getMatchKey(j1, j2);
            return matchsTermines.some(m => m.key === key);
          };

          const demarrerMatch = (j1, j2) => {
            if (isMatchTermine(j1, j2)) { alert('Ce match a d√©j√† √©t√© jou√©.'); return; }
            const pointsMax = config.typeMatch === '11pts' ? 11 : config.typeMatch === '15pts' ? 15 : 999;
            console.log('üéÆ D√©marrage match - Type:', config.typeMatch, '- Points max:', pointsMax);
            setMatchEnCours({
              joueur1: `${j1.prenom}_${j1.nom}`, joueur2: `${j2.prenom}_${j2.nom}`, 
              prenomJ1: j1.prenom, nomJ1: j1.nom, prenomJ2: j2.prenom, nomJ2: j2.nom,
              scoreJ1: 0, scoreJ2: 0, pointsDoublesJ1: 0, pointsDoublesJ2: 0,
              statsJ1: { zonesDangereuses: 0, smashAnnonces: 0, zonesLibres: 0, pointsSurService: 0, servicesRates: 0 },
              statsJ2: { zonesDangereuses: 0, smashAnnonces: 0, zonesLibres: 0, pointsSurService: 0, servicesRates: 0 },
              erreursServiceJ1: { nonTouche: 0, riviere: 0, nonCroise: 0, filet: 0 },
              erreursServiceJ2: { nonTouche: 0, riviere: 0, nonCroise: 0, filet: 0 },
              terrainJ1: [], terrainJ2: [], pointsMax, 
              changementCote: Math.floor(pointsMax / 2), coteChange: false
            });
            setHistoriquePoints([]);
            if (config.typeMatch === '3min') { setTimer(180); setTimerActif(true); }
            setPhase('jeu');
          };

          const ajouterPointAvecZone = (joueur, type, zone) => {
            setMatchEnCours(prev => {
              const nouveau = {...prev};
              const isDouble = type !== 'normal';
              setHistoriquePoints(hist => [...hist, {joueur, type, zone, etat: JSON.parse(JSON.stringify(prev))}]);

              if (joueur === 'j1') {
                nouveau.scoreJ1++;
                if (isDouble && config.pointsDoubles) nouveau.scoreJ1++;
                if (isDouble) nouveau.pointsDoublesJ1++;
                if (type === 'zoneDangereuse') nouveau.statsJ1.zonesDangereuses++;
                else if (type === 'smashAnnonce') nouveau.statsJ1.smashAnnonces++;
                else if (type === 'zoneLibre') nouveau.statsJ1.zonesLibres++;
                else if (type === 'pointSurService') nouveau.statsJ1.pointsSurService++;
                if (zone) nouveau.terrainJ1.push(zone);
                console.log('‚ûï Point J1 -', nouveau.prenomJ1, ':', nouveau.scoreJ1, '/', nouveau.pointsMax);
              } else {
                nouveau.scoreJ2++;
                if (isDouble && config.pointsDoubles) nouveau.scoreJ2++;
                if (isDouble) nouveau.pointsDoublesJ2++;
                if (type === 'zoneDangereuse') nouveau.statsJ2.zonesDangereuses++;
                else if (type === 'smashAnnonce') nouveau.statsJ2.smashAnnonces++;
                else if (type === 'zoneLibre') nouveau.statsJ2.zonesLibres++;
                else if (type === 'pointSurService') nouveau.statsJ2.pointsSurService++;
                if (zone) nouveau.terrainJ2.push(zone);
                console.log('‚ûï Point J2 -', nouveau.prenomJ2, ':', nouveau.scoreJ2, '/', nouveau.pointsMax);
              }

              if (config.mortSubite) {
                if (nouveau.pointsDoublesJ2 >= 3) { setTimeout(() => terminerMatch(true, 'j1'), 100); return nouveau; }
                if (nouveau.pointsDoublesJ1 >= 3) { setTimeout(() => terminerMatch(true, 'j2'), 100); return nouveau; }
              }

              if (!nouveau.coteChange && config.typeMatch !== '3min') {
                const total = nouveau.scoreJ1 + nouveau.scoreJ2;
                if (total >= nouveau.changementCote) {
                  nouveau.coteChange = true;
                  setTimeout(() => alert('üîÑ Changement de c√¥t√© !'), 100);
                }
              }

              return nouveau;
            });
          };

          const ajouterServiceRate = (joueurServeur, typeErreur) => {
            setMatchEnCours(prev => {
              const nouveau = {...prev};
              const joueurAdversaire = joueurServeur === 'j1' ? 'j2' : 'j1';
              
              setHistoriquePoints(hist => [...hist, {
                joueur: joueurAdversaire, 
                type: 'serviceRate', 
                typeErreur, 
                joueurServeur,
                etat: JSON.parse(JSON.stringify(prev))
              }]);

              // Le point va √† l'adversaire
              if (joueurAdversaire === 'j1') {
                nouveau.scoreJ1++;
              } else {
                nouveau.scoreJ2++;
              }

              // On enregistre l'erreur du serveur
              if (joueurServeur === 'j1') {
                nouveau.statsJ1.servicesRates++;
                if (typeErreur === 'nonTouche') nouveau.erreursServiceJ1.nonTouche++;
                else if (typeErreur === 'riviere') nouveau.erreursServiceJ1.riviere++;
                else if (typeErreur === 'nonCroise') nouveau.erreursServiceJ1.nonCroise++;
                else if (typeErreur === 'filet') nouveau.erreursServiceJ1.filet++;
              } else {
                nouveau.statsJ2.servicesRates++;
                if (typeErreur === 'nonTouche') nouveau.erreursServiceJ2.nonTouche++;
                else if (typeErreur === 'riviere') nouveau.erreursServiceJ2.riviere++;
                else if (typeErreur === 'nonCroise') nouveau.erreursServiceJ2.nonCroise++;
                else if (typeErreur === 'filet') nouveau.erreursServiceJ2.filet++;
              }

              console.log('‚ùå Service rat√© -', joueurServeur, '- Type:', typeErreur, '- Point pour:', joueurAdversaire);

              if (config.mortSubite) {
                if (nouveau.pointsDoublesJ2 >= 3) { setTimeout(() => terminerMatch(true, 'j1'), 100); return nouveau; }
                if (nouveau.pointsDoublesJ1 >= 3) { setTimeout(() => terminerMatch(true, 'j2'), 100); return nouveau; }
              }

              if (!nouveau.coteChange && config.typeMatch !== '3min') {
                const total = nouveau.scoreJ1 + nouveau.scoreJ2;
                if (total >= nouveau.changementCote) {
                  nouveau.coteChange = true;
                  setTimeout(() => alert('üîÑ Changement de c√¥t√© !'), 100);
                }
              }

              return nouveau;
            });
          };

          const ajouterPoint = (joueur, type) => ajouterPointAvecZone(joueur, type, null);

          const annulerDernierPoint = () => {
            if (historiquePoints.length === 0) { alert('Aucun point √† annuler'); return; }
            const dernierPoint = historiquePoints[historiquePoints.length - 1];
            setMatchEnCours(dernierPoint.etat);
            setHistoriquePoints(hist => hist.slice(0, -1));
          };

          const getIndiceReussite = (bonus, victoire) => {
            if (!victoire) return { texte: 'D√©faite', couleur: 'text-gray-600', icon: '‚ùå' };
            if (bonus >= 4) return { texte: 'Excellent', couleur: 'text-purple-600', icon: 'üèÜ' };
            if (bonus >= 3) return { texte: 'Tr√®s bien', couleur: 'text-green-600', icon: '‚≠ê' };
            if (bonus >= 2) return { texte: 'Bien', couleur: 'text-blue-600', icon: '‚úì' };
            if (bonus >= 1) return { texte: 'Assez bien', couleur: 'text-yellow-600', icon: '‚óã' };
            return { texte: 'Victoire simple', couleur: 'text-gray-600', icon: '‚Ä¢' };
          };

          const terminerMatch = (mortSubite = false, gagnant = null) => {
            if (!matchEnCours) {
              console.log('‚ö†Ô∏è terminerMatch appel√© mais pas de matchEnCours');
              return;
            }
            
            console.log('üèÅ FIN DE MATCH - Scores finaux:', matchEnCours.scoreJ1, '-', matchEnCours.scoreJ2);
            
            const {joueur1, joueur2, prenomJ1, nomJ1, prenomJ2, nomJ2, scoreJ1, scoreJ2, statsJ1, statsJ2, pointsDoublesJ1, pointsDoublesJ2, terrainJ1, terrainJ2, erreursServiceJ1, erreursServiceJ2} = matchEnCours;
            const victoireJ1 = mortSubite ? gagnant === 'j1' : scoreJ1 > scoreJ2;
            const victoireJ2 = mortSubite ? gagnant === 'j2' : scoreJ2 > scoreJ1;

            const matchKey = getMatchKey({prenom: prenomJ1, nom: nomJ1}, {prenom: prenomJ2, nom: nomJ2});
            setMatchsTermines(prev => [...prev, {
              key: matchKey, j1: joueur1, j2: joueur2, scoreJ1, scoreJ2, statsJ1, statsJ2,
              pointsDoublesJ1, pointsDoublesJ2, victoireJ1, mortSubite, date: new Date().toISOString()
            }]);

            setDonnees(prev => {
              const nouveau = {...prev};
              nouveau[joueur1].matchsJoues++;
              nouveau[joueur1].pointsMarques += scoreJ1;
              nouveau[joueur1].pointsEncaisses += scoreJ2;
              nouveau[joueur1].zonesDangereuses += statsJ1.zonesDangereuses;
              nouveau[joueur1].smashAnnonces += statsJ1.smashAnnonces;
              nouveau[joueur1].zonesLibres += statsJ1.zonesLibres;
              nouveau[joueur1].pointsSurService += statsJ1.pointsSurService;
              nouveau[joueur1].servicesRates += statsJ1.servicesRates;
              nouveau[joueur1].erreursServiceNonTouche += erreursServiceJ1.nonTouche;
              nouveau[joueur1].erreursServiceRiviere += erreursServiceJ1.riviere;
              nouveau[joueur1].erreursServiceNonCroise += erreursServiceJ1.nonCroise;
              nouveau[joueur1].erreursServiceFilet += erreursServiceJ1.filet;
              nouveau[joueur1].pointsDoubles += pointsDoublesJ1;
              nouveau[joueur1].pointsTerrain.push(...terrainJ1);
              if (victoireJ1) {
                nouveau[joueur1].matchsGagnes++;
                nouveau[joueur1].victoires.push({
                  adversaire: `${prenomJ2} ${nomJ2}`, score: `${scoreJ1}-${scoreJ2}`,
                  bonus: pointsDoublesJ1, indice: getIndiceReussite(pointsDoublesJ1, true)
                });
              } else if (mortSubite) nouveau[joueur1].defaitesMortSubite++;

              nouveau[joueur2].matchsJoues++;
              nouveau[joueur2].pointsMarques += scoreJ2;
              nouveau[joueur2].pointsEncaisses += scoreJ1;
              nouveau[joueur2].zonesDangereuses += statsJ2.zonesDangereuses;
              nouveau[joueur2].smashAnnonces += statsJ2.smashAnnonces;
              nouveau[joueur2].zonesLibres += statsJ2.zonesLibres;
              nouveau[joueur2].pointsSurService += statsJ2.pointsSurService;
              nouveau[joueur2].servicesRates += statsJ2.servicesRates;
              nouveau[joueur2].erreursServiceNonTouche += erreursServiceJ2.nonTouche;
              nouveau[joueur2].erreursServiceRiviere += erreursServiceJ2.riviere;
              nouveau[joueur2].erreursServiceNonCroise += erreursServiceJ2.nonCroise;
              nouveau[joueur2].erreursServiceFilet += erreursServiceJ2.filet;
              nouveau[joueur2].pointsDoubles += pointsDoublesJ2;
              nouveau[joueur2].pointsTerrain.push(...terrainJ2);
              if (victoireJ2) {
                nouveau[joueur2].matchsGagnes++;
                nouveau[joueur2].victoires.push({
                  adversaire: `${prenomJ1} ${nomJ1}`, score: `${scoreJ2}-${scoreJ1}`,
                  bonus: pointsDoublesJ2, indice: getIndiceReussite(pointsDoublesJ2, true)
                });
              } else if (mortSubite) nouveau[joueur2].defaitesMortSubite++;
              return nouveau;
            });

            if (seances[config.classe]?.[currentSeance]) {
              seances[config.classe][currentSeance].donnees = donnees;
            }
            setClasses(prev => ({...prev, [config.classe]: donnees}));
            setTimerActif(false);
            setMatchEnCours(null);
            setHistoriquePoints([]);
            setPhase('selection');
            sauvegarderDonnees();
          };

          const modifierMatch = (match) => { setShowEditMatch(match); };

          const sauvegarderModificationMatch = (newScoreJ1, newScoreJ2) => {
            setDonnees(prev => {
              const nouveau = {...prev};
              const match = showEditMatch;
              nouveau[match.j1].pointsMarques -= match.scoreJ1;
              nouveau[match.j1].pointsEncaisses -= match.scoreJ2;
              nouveau[match.j2].pointsMarques -= match.scoreJ2;
              nouveau[match.j2].pointsEncaisses -= match.scoreJ1;
              nouveau[match.j1].pointsMarques += newScoreJ1;
              nouveau[match.j1].pointsEncaisses += newScoreJ2;
              nouveau[match.j2].pointsMarques += newScoreJ2;
              nouveau[match.j2].pointsEncaisses += newScoreJ1;
              const nouvelleVictoireJ1 = newScoreJ1 > newScoreJ2;
              if (nouvelleVictoireJ1 !== match.victoireJ1) {
                if (nouvelleVictoireJ1) {
                  nouveau[match.j1].matchsGagnes++;
                  nouveau[match.j2].matchsGagnes--;
                } else {
                  nouveau[match.j1].matchsGagnes--;
                  nouveau[match.j2].matchsGagnes++;
                }
              }
              setMatchsTermines(prev => prev.map(m => m === match ? {...m, scoreJ1: newScoreJ1, scoreJ2: newScoreJ2, victoireJ1: nouvelleVictoireJ1} : m));
              setClasses(cl => ({...cl, [config.classe]: nouveau}));
              sauvegarderDonnees();
              return nouveau;
            });
            setShowEditMatch(null);
          };

          const supprimerMatch = (match) => {
            if (!confirm('Supprimer ce match ?')) return;
            setDonnees(prev => {
              const nouveau = {...prev};
              nouveau[match.j1].matchsJoues--;
              nouveau[match.j1].pointsMarques -= match.scoreJ1;
              nouveau[match.j1].pointsEncaisses -= match.scoreJ2;
              nouveau[match.j1].zonesDangereuses -= match.statsJ1.zonesDangereuses;
              nouveau[match.j1].smashAnnonces -= match.statsJ1.smashAnnonces;
              nouveau[match.j1].zonesLibres -= match.statsJ1.zonesLibres;
              nouveau[match.j1].pointsDoubles -= match.pointsDoublesJ1;
              if (match.victoireJ1) nouveau[match.j1].matchsGagnes--;
              nouveau[match.j2].matchsJoues--;
              nouveau[match.j2].pointsMarques -= match.scoreJ2;
              nouveau[match.j2].pointsEncaisses -= match.scoreJ1;
              nouveau[match.j2].zonesDangereuses -= match.statsJ2.zonesDangereuses;
              nouveau[match.j2].smashAnnonces -= match.statsJ2.smashAnnonces;
              nouveau[match.j2].zonesLibres -= match.statsJ2.zonesLibres;
              nouveau[match.j2].pointsDoubles -= match.pointsDoublesJ2;
              if (!match.victoireJ1) nouveau[match.j2].matchsGagnes--;
              setMatchsTermines(prev => prev.filter(m => m !== match));
              setClasses(cl => ({...cl, [config.classe]: nouveau}));
              sauvegarderDonnees();
              return nouveau;
            });
          };

          const TerrainBadminton = ({ points, joueurNom }) => {
            const zones = [
              { id: 1, x: 10, y: 10, w: 80, h: 80, label: 'AV G' },
              { id: 2, x: 110, y: 10, w: 80, h: 80, label: 'AV D' },
              { id: 3, x: 10, y: 110, w: 80, h: 80, label: 'AR G' },
              { id: 4, x: 110, y: 110, w: 80, h: 80, label: 'AR D' }
            ];
            const compteurs = {};
            points.forEach(p => { compteurs[p] = (compteurs[p] || 0) + 1; });
            return (
              <div className="mt-4 p-4 bg-white rounded-xl">
                <div className="text-sm font-bold text-gray-700 mb-2 text-center">üéØ Carte de frappe - {joueurNom}</div>
                <svg viewBox="0 0 200 200" className="w-full max-w-xs mx-auto">
                  <rect x="5" y="5" width="190" height="190" fill="#10b981" stroke="#047857" strokeWidth="2" rx="5"/>
                  <line x1="100" y1="5" x2="100" y2="195" stroke="#fff" strokeWidth="2" strokeDasharray="5,5"/>
                  <line x1="5" y1="100" x2="195" y2="100" stroke="#fff" strokeWidth="2" strokeDasharray="5,5"/>
                  {zones.map(zone => {
                    const count = compteurs[zone.id] || 0;
                    return (
                      <g key={zone.id}>
                        <rect x={zone.x} y={zone.y} width={zone.w} height={zone.h} fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.3)" strokeWidth="0.5"/>
                        {count > 0 && (
                          <>
                            <circle cx={zone.x + zone.w/2} cy={zone.y + zone.h/2} r="14" fill="#FFD700" stroke="#FFA500" strokeWidth="2"/>
                            <text x={zone.x + zone.w/2} y={zone.y + zone.h/2 + 5} textAnchor="middle" fontSize="12" fontWeight="bold" fill="#000">{count}</text>
                          </>
                        )}
                      </g>
                    );
                  })}
                </svg>
              </div>
            );
          };

          // RENDU DES PAGES
          if (phase === 'classe') {
            return (
              <div className="min-h-screen p-4">
                <div className="max-w-2xl mx-auto">
                  <div className="glass rounded-3xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <div className="badminton-icon">üè∏</div>
                      <h1 className="text-5xl font-extrabold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent mb-2">Badminton Pro</h1>
                      <p className="text-gray-600 font-medium">v2.2 - Avec objet Service</p>
                    </div>
                    <div className="mb-6">
                      <label className="block text-sm font-bold text-gray-700 mb-3">üìö Nom de la classe</label>
                      <input type="text" value={config.classe} onChange={(e) => setConfig({...config, classe: e.target.value})}
                        className="w-full px-5 py-4 border-2 border-emerald-300 rounded-xl focus:border-emerald-500 focus:outline-none text-lg font-medium shadow-sm"
                        placeholder="Ex: 3√®me A" />
                    </div>
                    {Object.keys(classes).length > 0 && (
                      <div className="mb-6">
                        <div className="flex justify-between items-center mb-3">
                          <p className="text-sm font-bold text-gray-700">üìÇ Classes existantes</p>
                          <button onClick={() => setShowDeleteModal(true)} className="text-red-600 text-sm flex items-center gap-1">
                            <Trash2 className="w-4 h-4" /> G√©rer
                          </button>
                        </div>
                        <div className="space-y-2">
                          {Object.keys(classes).map(cls => (
                            <button key={cls} onClick={() => { setConfig({...config, classe: cls}); setDonnees(classes[cls]); }}
                              className="w-full text-left px-5 py-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border-2 border-emerald-200">
                              <span className="font-bold text-emerald-700">{cls}</span>
                              <span className="text-sm text-gray-600 ml-2">({Object.keys(classes[cls]).length} √©l√®ves)</span>
                            </button>
                          ))}
                        </div>
                      </div>
                    )}
                    <button onClick={() => setPhase('config')} disabled={!config.classe.trim()}
                      className="w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-4 rounded-xl font-bold text-lg disabled:from-gray-300">
                      Continuer ‚Üí
                    </button>
                  </div>
                </div>

                {showDeleteModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="glass rounded-2xl p-6 max-w-md w-full">
                      <h3 className="text-xl font-bold mb-4">üóëÔ∏è Supprimer des classes</h3>
                      <div className="space-y-2 mb-6">
                        {Object.keys(classes).map(cls => (
                          <div key={cls} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span className="font-medium">{cls}</span>
                            <button onClick={() => {
                              if (confirm(`Supprimer "${cls}" ?`)) {
                                const updated = {...classes};
                                delete updated[cls];
                                setClasses(updated);
                                sauvegarderDonnees();
                              }
                            }} className="text-red-600 p-2 hover:bg-red-50 rounded">
                              <Trash2 className="w-5 h-5" />
                            </button>
                          </div>
                        ))}
                      </div>
                      <button onClick={() => setShowDeleteModal(false)} className="w-full bg-gray-600 text-white py-3 rounded-lg font-bold">
                        Fermer
                      </button>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          if (phase === 'config') {
            return (
              <div className="min-h-screen p-4">
                <div className="max-w-2xl mx-auto">
                  <div className="glass rounded-3xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <Users className="w-12 h-12 text-emerald-600 mx-auto mb-4" />
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">{config.classe}</h1>
                      <p className="text-gray-600 font-medium">Configuration de la poule</p>
                    </div>
                    {config.nombreJoueurs === 0 ? (
                      <div>
                        <p className="text-center font-bold mb-6 text-lg">Combien d'√©l√®ves ?</p>
                        <div className="grid grid-cols-4 gap-3">
                          {[2, 3, 4, 5].map(nb => (
                            <button key={nb} onClick={() => {
                              const nouveauxJoueurs = Array(nb).fill(null).map(() => ({prenom: '', nom: ''}));
                              setConfig({...config, nombreJoueurs: nb, joueurs: nouveauxJoueurs});
                            }} className="bg-gradient-to-br from-emerald-500 to-teal-500 text-white py-8 rounded-2xl font-bold text-3xl shadow-lg">
                              {nb}
                            </button>
                          ))}
                        </div>
                      </div>
                    ) : (
                      <div>
                        <div className="space-y-3 mb-6">
                          {config.joueurs.map((joueur, index) => (
                            <div key={index} className="grid grid-cols-2 gap-2">
                              <input type="text" value={joueur.prenom} onChange={(e) => modifierJoueur(index, 'prenom', e.target.value)}
                                className="px-4 py-3 border-2 border-emerald-300 rounded-xl focus:border-emerald-500 focus:outline-none" placeholder="Pr√©nom" />
                              <input type="text" value={joueur.nom} onChange={(e) => modifierJoueur(index, 'nom', e.target.value)}
                                className="px-4 py-3 border-2 border-emerald-300 rounded-xl focus:border-emerald-500 focus:outline-none" placeholder="Nom" />
                            </div>
                          ))}
                        </div>
                        <div className="flex gap-3">
                          <button onClick={() => setConfig({...config, nombreJoueurs: 0, joueurs: []})}
                            className="flex-1 bg-gray-500 text-white py-4 rounded-xl font-bold">‚Üê Retour</button>
                          <button onClick={() => setPhase('objetEnseignement')} disabled={config.joueurs.some(j => !j.nom.trim() || !j.prenom.trim())}
                            className="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-4 rounded-xl font-bold disabled:from-gray-300">Suivant ‚Üí</button>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          if (phase === 'objetEnseignement') {
            return (
              <div className="min-h-screen p-4">
                <div className="max-w-2xl mx-auto">
                  <div className="glass rounded-3xl shadow-2xl p-8">
                    <h2 className="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                      üéØ Objet d'enseignement
                    </h2>
                    <div className="space-y-3 mb-6">
                      {[
                        {val: 'smash', icon: Zap, title: '‚ö° Travail du smash annonc√©', desc: 'Crier "smash" avant', color: 'purple'},
                        {val: 'zones', icon: Target, title: 'üéØ Viser zones dangereuses', desc: 'Zones avant/arri√®re', color: 'orange'},
                        {val: 'espaces', icon: MapPin, title: 'üìç Viser espaces libres', desc: 'O√π l\'adversaire n\'est pas', color: 'green'},
                        {val: 'service', icon: Send, title: 'üè∏ Efficacit√© du service', desc: 'Marquer le point sur service', color: 'blue'}
                      ].map(({val, icon: Icon, title, desc, color}) => (
                        <button key={val} onClick={() => setConfig({...config, objetEnseignement: val})}
                          className={`w-full p-5 rounded-2xl border-2 transition shadow-md ${
                            config.objetEnseignement === val ? `border-${color}-600 bg-gradient-to-r from-${color}-50 to-${color}-100` : 'border-gray-300 bg-white'
                          }`}>
                          <div className="flex items-center gap-4">
                            <Icon className={`w-8 h-8 text-${color}-600`} />
                            <div className="text-left"><div className="font-bold text-lg">{title}</div><div className="text-sm text-gray-600">{desc}</div></div>
                          </div>
                        </button>
                      ))}
                    </div>
                    <div className="flex gap-3">
                      <button onClick={() => setPhase('config')} className="flex-1 bg-gray-500 text-white py-4 rounded-xl font-bold">‚Üê Retour</button>
                      <button onClick={() => setPhase('typeMatch')} disabled={!config.objetEnseignement}
                        className="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-4 rounded-xl font-bold disabled:from-gray-300">Suivant ‚Üí</button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (phase === 'typeMatch') {
            return (
              <div className="min-h-screen p-4">
                <div className="max-w-2xl mx-auto">
                  <div className="glass rounded-3xl shadow-2xl p-8">
                    <h2 className="text-3xl font-bold text-center mb-6">‚öôÔ∏è Configuration du match</h2>
                    <div className="mb-6">
                      <h3 className="font-bold text-gray-700 mb-3">Type de match</h3>
                      <div className="space-y-3">
                        {[
                          {value: '3min', icon: Clock, title: 'Match en 3 minutes'},
                          {value: '11pts', icon: Target, title: 'Match en 11 points'},
                          {value: '15pts', icon: Target, title: 'Match en 15 points'}
                        ].map(({value, icon: Icon, title}) => (
                          <button key={value} onClick={() => setConfig({...config, typeMatch: value})}
                            className={`w-full p-4 rounded-xl border-2 transition ${
                              config.typeMatch === value ? 'border-emerald-600 bg-gradient-to-r from-emerald-50 to-teal-50' : 'border-gray-300 bg-white'
                            }`}>
                            <div className="flex items-center gap-3">
                              <Icon className="w-7 h-7 text-emerald-600" />
                              <div className="font-bold">{title}</div>
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                    <div className="mb-6">
                      <h3 className="font-bold text-gray-700 mb-3">Options</h3>
                      <div className="space-y-3">
                        <label className="flex items-center p-4 rounded-xl border-2 cursor-pointer hover:bg-blue-50 border-gray-300">
                          <input type="checkbox" checked={config.pointsDoubles} onChange={(e) => setConfig({...config, pointsDoubles: e.target.checked})}
                            className="w-5 h-5 text-blue-600 rounded" />
                          <div className="ml-3"><div className="font-bold">üèÜ Points doubles</div></div>
                        </label>
                        <label className="flex items-center p-4 rounded-xl border-2 cursor-pointer hover:bg-red-50 border-gray-300">
                          <input type="checkbox" checked={config.mortSubite} onChange={(e) => setConfig({...config, mortSubite: e.target.checked})}
                            className="w-5 h-5 text-red-600 rounded" />
                          <div className="ml-3"><div className="font-bold">‚ö†Ô∏è Mort subite</div></div>
                        </label>
                      </div>
                    </div>
                    <div className="flex gap-3">
                      <button onClick={() => setPhase('objetEnseignement')} className="flex-1 bg-gray-500 text-white py-4 rounded-xl font-bold">‚Üê Retour</button>
                      <button onClick={demarrerPoule} disabled={!config.typeMatch}
                        className="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-4 rounded-xl font-bold disabled:from-gray-300">üöÄ D√©marrer</button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (phase === 'selection') {
            return (
              <div className="min-h-screen p-4">
                <div className="max-w-6xl mx-auto">
                  <div className="glass rounded-3xl p-8 mb-6">
                    <h1 className="text-4xl font-bold text-center mb-8 bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                      üè∏ {config.classe} - Poule
                    </h1>
                    <div className="grid md:grid-cols-2 gap-6">
                      {poule.map((j1, i) => poule.slice(i + 1).map(j2 => {
                        const termine = isMatchTermine(j1, j2);
                        return (
                          <div key={`${j1.prenom}-${j2.prenom}`}
                            className={`${termine ? 'match-done' : 'match-pending'} rounded-2xl p-6 text-white cursor-pointer transition-all hover:scale-105`}
                            onClick={() => !termine && demarrerMatch(j1, j2)}>
                            <div className="flex items-center justify-between">
                              <div className="flex-1">
                                <h3 className="text-xl font-bold">{j1.prenom} {j1.nom}</h3>
                                <div className="text-sm opacity-90 mt-1">vs</div>
                                <h3 className="text-xl font-bold mt-1">{j2.prenom} {j2.nom}</h3>
                              </div>
                              <div className="text-4xl">{termine ? '‚úì' : '‚ñ∂'}</div>
                            </div>
                          </div>
                        );
                      }))}
                    </div>
                  </div>
                  <div className="grid md:grid-cols-2 gap-4">
                    <button onClick={() => setPhase('stats')} className="bg-gradient-to-r from-purple-600 to-pink-600 text-white py-5 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                      <BarChart className="w-6 h-6" />Statistiques
                    </button>
                    <button onClick={() => { if (confirm('Retour config ?')) setPhase('classe'); }}
                      className="bg-gradient-to-r from-gray-600 to-gray-700 text-white py-5 rounded-xl font-bold text-lg">
                      ‚Üê Retour
                    </button>
                  </div>
                </div>

                {showEditMatch && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="glass rounded-2xl p-6 max-w-md w-full">
                      <h3 className="text-xl font-bold mb-4">‚úèÔ∏è Modifier le match</h3>
                      <div className="grid grid-cols-2 gap-4 mb-6">
                        <div>
                          <label className="block text-sm font-bold mb-2">Score {donnees[showEditMatch.j1]?.prenom}</label>
                          <input type="number" id="newScoreJ1" defaultValue={showEditMatch.scoreJ1}
                            className="w-full px-4 py-3 border-2 border-emerald-300 rounded-xl text-center text-2xl font-bold" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold mb-2">Score {donnees[showEditMatch.j2]?.prenom}</label>
                          <input type="number" id="newScoreJ2" defaultValue={showEditMatch.scoreJ2}
                            className="w-full px-4 py-3 border-2 border-emerald-300 rounded-xl text-center text-2xl font-bold" />
                        </div>
                      </div>
                      <div className="flex gap-3">
                        <button onClick={() => setShowEditMatch(null)} className="flex-1 bg-gray-500 text-white py-3 rounded-xl font-bold">Annuler</button>
                        <button onClick={() => {
                          sauvegarderModificationMatch(parseInt(document.getElementById('newScoreJ1').value), parseInt(document.getElementById('newScoreJ2').value));
                        }} className="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-3 rounded-xl font-bold">üíæ OK</button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          if (phase === 'stats') {
            return (
              <div className="min-h-screen p-4">
                <div className="max-w-6xl mx-auto">
                  <div className="glass rounded-3xl p-8 mb-6">
                    <h1 className="text-4xl font-bold text-center mb-8 bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                      üìä Statistiques - {config.classe}
                    </h1>
                    <div className="grid md:grid-cols-2 gap-6">
                      {Object.values(donnees).map(joueur => {
                        const tauxVictoire = joueur.matchsJoues > 0 ? (joueur.matchsGagnes / joueur.matchsJoues) * 100 : 0;
                        const progressionGlobale = joueur.zonesDangereuses + joueur.smashAnnonces + joueur.zonesLibres + joueur.pointsDoubles + joueur.pointsSurService;
                        const tauxServiceReussi = (joueur.pointsSurService + joueur.servicesRates) > 0 ? 
                          (joueur.pointsSurService / (joueur.pointsSurService + joueur.servicesRates) * 100) : 0;
                        return (
                          <div key={`${joueur.prenom}_${joueur.nom}`} className="stat-card rounded-2xl p-6">
                            <h3 className="text-2xl font-bold mb-4 text-emerald-700">{joueur.prenom} {joueur.nom}</h3>
                            <div className="mb-4">
                              <div className="flex justify-between mb-2"><span>Taux victoire</span><span className="font-bold">{tauxVictoire.toFixed(0)}%</span></div>
                              <div className="w-full bg-gray-200 rounded-full h-4"><div className="bg-gradient-to-r from-yellow-400 to-orange-500 h-4 rounded-full" style={{width: `${tauxVictoire}%`}}></div></div>
                            </div>
                            <div className="grid grid-cols-4 gap-2 mb-4 text-center">
                              <div className="bg-white p-3 rounded-lg"><div className="text-2xl font-bold text-green-600">{joueur.matchsGagnes}</div><div className="text-xs">Victoires</div></div>
                              <div className="bg-white p-3 rounded-lg"><div className="text-2xl font-bold text-orange-600">{joueur.zonesDangereuses}</div><div className="text-xs">ZD</div></div>
                              <div className="bg-white p-3 rounded-lg"><div className="text-2xl font-bold text-purple-600">{joueur.smashAnnonces}</div><div className="text-xs">SA</div></div>
                              <div className="bg-white p-3 rounded-lg"><div className="text-2xl font-bold text-teal-600">{joueur.zonesLibres}</div><div className="text-xs">ZL</div></div>
                            </div>
                            <div className="grid grid-cols-2 gap-2 mb-4 text-center">
                              <div className="bg-white p-3 rounded-lg">
                                <div className="text-2xl font-bold text-blue-600">{joueur.pointsSurService}</div>
                                <div className="text-xs">Pts Service</div>
                              </div>
                              <div className="bg-white p-3 rounded-lg">
                                <div className="text-2xl font-bold text-red-600">{joueur.servicesRates}</div>
                                <div className="text-xs">Srv Rat√©s</div>
                              </div>
                            </div>
                            {(joueur.pointsSurService + joueur.servicesRates) > 0 && (
                              <div className="mb-4">
                                <div className="flex justify-between mb-2 text-sm">
                                  <span>Efficacit√© service</span>
                                  <span className="font-bold">{tauxServiceReussi.toFixed(0)}%</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-3">
                                  <div className="bg-gradient-to-r from-blue-400 to-blue-600 h-3 rounded-full" style={{width: `${tauxServiceReussi}%`}}></div>
                                </div>
                              </div>
                            )}
                            {joueur.servicesRates > 0 && (
                              <div className="bg-red-50 p-3 rounded-lg mb-4">
                                <div className="text-xs font-bold text-red-700 mb-2">D√©tail erreurs service :</div>
                                <div className="grid grid-cols-4 gap-1 text-xs">
                                  <div className="text-center">
                                    <div className="font-bold text-red-600">{joueur.erreursServiceNonTouche || 0}</div>
                                    <div className="text-gray-600">Non touch√©</div>
                                  </div>
                                  <div className="text-center">
                                    <div className="font-bold text-red-600">{joueur.erreursServiceRiviere || 0}</div>
                                    <div className="text-gray-600">Rivi√®re</div>
                                  </div>
                                  <div className="text-center">
                                    <div className="font-bold text-red-600">{joueur.erreursServiceNonCroise || 0}</div>
                                    <div className="text-gray-600">Non crois√©</div>
                                  </div>
                                  <div className="text-center">
                                    <div className="font-bold text-red-600">{joueur.erreursServiceFilet || 0}</div>
                                    <div className="text-gray-600">Filet</div>
                                  </div>
                                </div>
                              </div>
                            )}
                            {joueur.pointsTerrain.length > 0 && <TerrainBadminton points={joueur.pointsTerrain} joueurNom={`${joueur.prenom}`} />}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  <button onClick={() => setPhase('selection')} className="w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white py-4 rounded-xl font-bold">
                    ‚Üê Retour
                  </button>
                </div>
              </div>
            );
          }

          if (phase === 'jeu' && matchEnCours) {
            const getButtonForObjet = (joueur) => {
              const pointsText = config.pointsDoubles ? '+2' : '+1';
              if (config.objetEnseignement === 'smash') {
                return (
                  <button onClick={() => ajouterPoint(joueur, 'smashAnnonce')}
                    className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-5 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                    <Zap className="w-6 h-6" />Smash ({pointsText})
                  </button>
                );
              } else if (config.objetEnseignement === 'service') {
                return (
                  <div className="space-y-3">
                    <button onClick={() => ajouterPoint(joueur, 'pointSurService')}
                      className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-5 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                      <Send className="w-6 h-6" />Point sur service ({pointsText})
                    </button>
                    <button onClick={() => setShowServiceErreur(joueur)}
                      className="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2">
                      ‚ùå Service rat√©
                    </button>
                  </div>
                );
              } else {
                return (
                  <button onClick={() => setShowTerrain(joueur)}
                    className={`w-full ${config.objetEnseignement === 'zones' ? 'bg-gradient-to-r from-orange-500 to-red-500' : 'bg-gradient-to-r from-green-500 to-teal-500'} text-white py-5 rounded-xl font-bold text-lg flex items-center justify-center gap-2`}>
                    {config.objetEnseignement === 'zones' ? <Target className="w-6 h-6" /> : <MapPin className="w-6 h-6" />}
                    {config.objetEnseignement === 'zones' ? 'Zone dangereuse' : 'Zone libre'} ({pointsText})
                  </button>
                );
              }
            };

            return (
              <div className="min-h-screen p-4">
                <div className="max-w-6xl mx-auto">
                  {config.typeMatch === '3min' && (
                    <div className="glass rounded-2xl p-4 mb-6 text-center">
                      <div className={`inline-block px-8 py-3 rounded-full font-bold text-3xl ${timer <= 30 ? 'bg-red-100 text-red-600' : 'bg-emerald-100 text-emerald-600'}`}>
                        ‚è±Ô∏è {formatTimer(timer)}
                      </div>
                    </div>
                  )}

                  <div className="glass rounded-3xl p-8 mb-6">
                    <div className="grid grid-cols-3 gap-6 items-center">
                      <div className="text-center">
                        <h3 className="text-2xl font-bold mb-3 text-blue-600">{matchEnCours.prenomJ1} {matchEnCours.nomJ1}</h3>
                        <div className="text-7xl font-extrabold text-blue-600">{matchEnCours.scoreJ1}</div>
                      </div>
                      <div className="text-center text-5xl font-extrabold text-gray-400">VS</div>
                      <div className="text-center">
                        <h3 className="text-2xl font-bold mb-3 text-red-600">{matchEnCours.prenomJ2} {matchEnCours.nomJ2}</h3>
                        <div className="text-7xl font-extrabold text-red-600">{matchEnCours.scoreJ2}</div>
                      </div>
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-6 mb-6">
                    <div className="glass rounded-2xl p-6">
                      <h3 className="text-xl font-bold text-blue-600 mb-4">{matchEnCours.prenomJ1}</h3>
                      <div className="space-y-3">
                        <button onClick={() => ajouterPoint('j1', 'normal')} className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-5 rounded-xl font-bold text-lg">Point normal (+1)</button>
                        {getButtonForObjet('j1')}
                      </div>
                      <div className="mt-4 p-4 bg-blue-50 rounded-xl">
                        <div className="grid grid-cols-3 gap-3 text-xs">
                          <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-orange-600">{matchEnCours.statsJ1.zonesDangereuses}</div><div>ZD</div></div>
                          <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-purple-600">{matchEnCours.statsJ1.smashAnnonces}</div><div>SA</div></div>
                          <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-green-600">{matchEnCours.statsJ1.zonesLibres}</div><div>ZL</div></div>
                        </div>
                        {config.objetEnseignement === 'service' && (
                          <div className="grid grid-cols-2 gap-3 text-xs mt-3">
                            <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-blue-600">{matchEnCours.statsJ1.pointsSurService}</div><div>Pts Srv</div></div>
                            <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-red-600">{matchEnCours.statsJ1.servicesRates}</div><div>Srv ‚ùå</div></div>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="glass rounded-2xl p-6">
                      <h3 className="text-xl font-bold text-red-600 mb-4">{matchEnCours.prenomJ2}</h3>
                      <div className="space-y-3">
                        <button onClick={() => ajouterPoint('j2', 'normal')} className="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-5 rounded-xl font-bold text-lg">Point normal (+1)</button>
                        {getButtonForObjet('j2')}
                      </div>
                      <div className="mt-4 p-4 bg-red-50 rounded-xl">
                        <div className="grid grid-cols-3 gap-3 text-xs">
                          <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-orange-600">{matchEnCours.statsJ2.zonesDangereuses}</div><div>ZD</div></div>
                          <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-purple-600">{matchEnCours.statsJ2.smashAnnonces}</div><div>SA</div></div>
                          <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-green-600">{matchEnCours.statsJ2.zonesLibres}</div><div>ZL</div></div>
                        </div>
                        {config.objetEnseignement === 'service' && (
                          <div className="grid grid-cols-2 gap-3 text-xs mt-3">
                            <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-blue-600">{matchEnCours.statsJ2.pointsSurService}</div><div>Pts Srv</div></div>
                            <div className="text-center p-2 bg-white rounded-lg"><div className="text-2xl font-bold text-red-600">{matchEnCours.statsJ2.servicesRates}</div><div>Srv ‚ùå</div></div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4 mb-4">
                    <button onClick={() => { if (confirm('Terminer ?')) terminerMatch(); }}
                      className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-5 rounded-xl font-bold text-lg">‚úì Terminer</button>
                    <button onClick={annulerDernierPoint} disabled={historiquePoints.length === 0}
                      className="bg-gradient-to-r from-orange-500 to-orange-600 text-white py-5 rounded-xl font-bold text-lg disabled:from-gray-300 flex items-center justify-center gap-2">
                      <RotateCcw className="w-5 h-5" />Annuler ({historiquePoints.length})
                    </button>
                  </div>

                  <button onClick={() => { if (confirm('Annuler ?')) { setMatchEnCours(null); setPhase('selection'); }}}
                    className="w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white py-4 rounded-xl font-bold">‚Üê Retour</button>
                </div>

                {/* PAGE PLEIN √âCRAN POUR LES ZONES */}
                <div className={`page-zones-fullscreen ${showTerrain ? 'active' : ''}`}>
                  <div style={{color: 'white', textAlign: 'center', fontSize: '28px', fontWeight: 'bold', marginBottom: '30px'}}>
                    üè∏ S√©lectionnez la zone
                  </div>
                  <div style={{flex: 1, display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '20px'}}>
                    {[
                      {id: 1, label: 'Avant Gauche', emoji: '‚¨ÜÔ∏è', color: 'linear-gradient(135deg, #10b981, #059669)'},
                      {id: 2, label: 'Avant Droite', emoji: '‚¨ÜÔ∏è', color: 'linear-gradient(135deg, #10b981, #059669)'},
                      {id: 3, label: 'Arri√®re Gauche', emoji: '‚¨áÔ∏è', color: 'linear-gradient(135deg, #047857, #065f46)'},
                      {id: 4, label: 'Arri√®re Droite', emoji: '‚¨áÔ∏è', color: 'linear-gradient(135deg, #047857, #065f46)'}
                    ].map(zone => (
                      <button key={zone.id} onClick={() => {
                        const type = config.objetEnseignement === 'zones' ? 'zoneDangereuse' : 'zoneLibre';
                        ajouterPointAvecZone(showTerrain, type, zone.id);
                        setShowTerrain(false);
                      }} style={{
                        background: zone.color,
                        color: 'white',
                        border: 'none',
                        borderRadius: '20px',
                        fontSize: '18px',
                        fontWeight: 'bold',
                        padding: '30px',
                        minHeight: '160px',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '12px',
                        cursor: 'pointer'
                      }}>
                        <div style={{fontSize: '50px'}}>{zone.emoji}</div>
                        <div style={{fontSize: '18px'}}>{zone.label}</div>
                        <div style={{fontSize: '48px', fontWeight: 'bold'}}>{zone.id}</div>
                      </button>
                    ))}
                  </div>
                  <button onClick={() => setShowTerrain(false)} style={{
                    width: '100%',
                    background: '#6b7280',
                    color: 'white',
                    border: 'none',
                    padding: '20px',
                    borderRadius: '15px',
                    fontSize: '20px',
                    fontWeight: 'bold',
                    cursor: 'pointer'
                  }}>
                    ‚úï Annuler
                  </button>
                </div>

                {/* PAGE PLEIN √âCRAN POUR LES ERREURS DE SERVICE */}
                <div className={`page-service-erreur-fullscreen ${showServiceErreur ? 'active' : ''}`}>
                  <div style={{color: 'white', textAlign: 'center', fontSize: '28px', fontWeight: 'bold', marginBottom: '30px'}}>
                    ‚ùå Type d'erreur de service
                  </div>
                  <div style={{flex: 1, display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '20px'}}>
                    {[
                      {type: 'nonTouche', label: 'Non touch√©', desc: 'Le serveur n\'a pas touch√© le volant avec la raquette', emoji: 'üè∏', color: 'linear-gradient(135deg, #dc2626, #991b1b)'},
                      {type: 'riviere', label: 'Rivi√®re', desc: 'Le volant tombe dans la zone interdite', emoji: 'üåä', color: 'linear-gradient(135deg, #ea580c, #c2410c)'},
                      {type: 'nonCroise', label: 'Non crois√©', desc: 'Le volant n\'est pas crois√©', emoji: '‚ÜóÔ∏è', color: 'linear-gradient(135deg, #f97316, #ea580c)'},
                      {type: 'filet', label: 'Filet', desc: 'Le volant ne franchit pas le filet', emoji: 'ü•Ö', color: 'linear-gradient(135deg, #fb923c, #f97316)'}
                    ].map(erreur => (
                      <button key={erreur.type} onClick={() => {
                        ajouterServiceRate(showServiceErreur, erreur.type);
                        setShowServiceErreur(false);
                      }} style={{
                        background: erreur.color,
                        color: 'white',
                        border: 'none',
                        borderRadius: '20px',
                        fontSize: '16px',
                        fontWeight: 'bold',
                        padding: '25px',
                        minHeight: '160px',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '10px',
                        cursor: 'pointer',
                        textAlign: 'center'
                      }}>
                        <div style={{fontSize: '50px'}}>{erreur.emoji}</div>
                        <div style={{fontSize: '20px', fontWeight: 'bold'}}>{erreur.label}</div>
                        <div style={{fontSize: '13px', opacity: 0.9}}>{erreur.desc}</div>
                      </button>
                    ))}
                  </div>
                  <button onClick={() => setShowServiceErreur(false)} style={{
                    width: '100%',
                    background: '#6b7280',
                    color: 'white',
                    border: 'none',
                    padding: '20px',
                    borderRadius: '15px',
                    fontSize: '20px',
                    fontWeight: 'bold',
                    cursor: 'pointer'
                  }}>
                    ‚úï Annuler
                  </button>
                </div>
              </div>
            );
          }

          return null;
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<BadmintonTracker />);
        console.log('‚úÖ Badminton Pro v2.2 charg√© - Avec objet Service');
    </script>
</body>
</html>
